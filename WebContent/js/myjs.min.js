var userdata_tel={};var users=[];var current_telno;function inituserdata_tel(){var u={};var t={};t["data"]={};t["counter"]=2;t["status"]="unlogin";t["userlistname"]={};u["00000000"]=t;return u}function getTelInfo(a){}var dataResearchedFlg=false;function getSearchResult(){if(!islogin()){$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(a){login(getSearchResult)});$('#popupLogin').popup('open');return}var b=validatconditonForm();if(b.numberOfInvalids()>0){return}var t={};var c=$("[id$='param_con']");for(var i=0;i<c.size();i++){var d=$(c[i]);if(d.hasClass("invisibleofdiv")){continue}else{var e=d.find($("[name$='_condition_text']"));var f={};if(e.val()==""){continue}f[e.attr("id")]=e.val();t=$.extend(true,t,f)}}if($.isEmptyObject(t)){return}t["tel"]=current_telno;var g=window.location.href;var h;if(g.lastIndexOf("/","http")!=g.length-1){h="deal/"+JSON.stringify(t)}else{h=JSON.stringify(t)}htmlobj=$.ajax({url:h,async:false});$("#table-custom-2").table("refresh");$("#dataResult").html(htmlobj.responseText);$("#table-custom-2").table("refresh");$("#msgzone").html($("#resultmsg").html());$("#resultmsg").remove();dataResearchedFlg=true}function islogin(){if(userdata_tel.status=="unlogin"){return false}return true}function login(e){if(!$("#loginform").valid()){return false}var f=false;$.each(users,function(c,d){$.each(d,function(a,b){if(a==$(tel).val()){b.status="login";userdata_tel=b;current_telno=$(tel).val();f=true;return}});if(f)return});if(!f){var u={};var t=inituserdata_tel();current_telno=$(tel).val();t["00000000"].status="login";u[$(tel).val()]=t["00000000"];userdata_tel=u[$(tel).val()];users.push(u)}setOptions();controlloginIcon();localStorage.users=JSON.stringify(users);$("#popupLogin").unbind("popupafterclose");$("#popupLogin").on("popupafterclose",function(b,c){e();$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(a){login(donothing)})});$("#popupLogin").popup("close");return true}function donothing(){}function logout(){$.each(users,function(c,d){$.each(d,function(a,b){b.status="unlogin"})});current_telno="00000000";userdata_tel=inituserdata_tel()["00000000"];setOptions("init");controlloginIcon();localStorage.users=JSON.stringify(users)}var systemlistname={"0":"参数设定","1":"强市参数(系统)","2":"弱市参数(系统)"};var systemlistname2={"0":"自定义参数列表"};var systemdata={"1":{"dayk":"5,8,80,1","weekk":"5,8,80,1","onlykd":"0,3,1,5,10,20","onlykw":"0,3,1,5,10,10","zt":"100,2","currentk":"1,1,5,-5,5","duringk":"0,30,25","bankuai":"00,30,60"},"2":{"dayk":"5,8,50,-1","weekk":"5,8,50,1","onlykd":"0,3,1,5,10,20","onlykw":"0,3,1,5,10,10","zt":"100,5","currentk":"1,-1,5,-5,5","duringk":"0,30,15","bankuai":"00,30,60"}};var userdata_temp={};function insertSlectBoxOption(d){userdata_temp=userdata_tel.data;if(!$("#saveeditor_form").valid()){return false};userdata_tel.counter++;var e={};$("[name$='_condition_text']").each(function(a,b){if(!$("#"+b.id).parent().parent().parent().hasClass("invisibleofdiv")){var c={};c[b.id]=b.value;e=$.extend(true,e,c)}});userdata_temp[userdata_tel.counter]=e;jQuery("<option value='"+userdata_tel.counter+"'>"+$("#parametername").val()+"</option>").appendTo("#"+d);jQuery("<option value='"+userdata_tel.counter+"'>"+$("#parametername").val()+"</option>").appendTo("#customprams");userdata_tel.data=userdata_temp;userdata_tel.userlistname[userdata_tel.counter]=$("#parametername").val();if(window.localStorage){localStorage.users=JSON.stringify(users)}$("#popupSaveoredit").popup("close")}function openpopupforDeletePram(){var a=$("#customprams").val();if(a==0){return}else{$("#popupforDeletePram").popup("open")}}function openeditsavePopup(){if(!islogin()){$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(a){login(openeditsavePopup)});$('#popupLogin').popup('open')}else{$('#popupSaveoredit').popup('open')}}function deletecustomParams(){var c=$("#customprams").val();choosefirstOptionOfselectbox("#customprams");choosefirstOptionOfselectbox("#parameterSetting");$("#customprams option[value="+c+"]").remove();$("#parameterSetting option[value="+c+"]").remove();$.each(userdata_tel.data[c],function(a,b){$("#"+a+"_editor").val("")});delete userdata_tel.data[c];delete userdata_tel.userlistname[c];if(window.localStorage){localStorage.users=JSON.stringify(users)}}function getValuessub(d,o){var a={};$.each(o,function(k,v){a[k]=v});$.each(d,function(k,v){delete a[k]});return a}function setValues(g){if(g=="0"){return}var h;if(g!="1"&&g!="2"){h=userdata_tel.data}else{h=systemdata}if(g!="1"&&g!="2"){var s=getValuessub(h[g],systemdata["1"]);$.each(s,function(a,b){var c=$("#"+a);var d=c.parent().parent().parent();var e=d.attr("name");var f=$("[name="+"'"+e+"'"+"]");d.addClass("invisibleofdiv");$(f.get(0)).removeClass("invisibleofdiv")});$.each(h[g],function(a,b){var c=$("#"+a);c.val(b);var d=c.parent().parent().parent();var e=d.attr("name");var f=$("[name="+"'"+e+"'"+"]");$(f.get(0)).addClass("invisibleofdiv");d.removeClass("invisibleofdiv")})}else{$.each(h[g],function(a,b){var c=$("#"+a);c.val(b)})}return false}function setValuesForeditor(c){if(c=="0"){return}var d;d=userdata_tel.data;$.each(d[c],function(a,b){$("#"+a+"_editor").val(b)});return false}function openpopupforSavePram(){var a=$("#customprams").val();if(a==0){return}else{$("#popupforSavePram").popup("open")}}function saveEditor(){var d={};$("[name$='_editor_text']").each(function(a,b){var c={};c[b.id.split("_")[0]]=b.value;d=$.extend(true,d,c)});userdata_tel.data[$("#customprams").val()]=d;if(window.localStorage){localStorage.userdata_tel=JSON.stringify(userdata_tel)}choosefirstOptionOfselectbox("#parameterSetting")}$(document).on("click",".show-page-loading-msg",function(){var a=$(this),theme=a.jqmData("theme")||$.mobile.loader.prototype.options.theme,msgText=a.jqmData("msgtext")||$.mobile.loader.prototype.options.text,textVisible=a.jqmData("textvisible")||$.mobile.loader.prototype.options.textVisible,textonly=!!a.jqmData("textonly");html=a.jqmData("html")||"";$.mobile.loading("show",{text:msgText,textVisible:textVisible,theme:theme,textonly:textonly,html:html})}).on("click",".hide-page-loading-msg",function(){$.mobile.loading("hide")});Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};function choosefirstOptionOfselectbox(a){$(a+" option[value='0']").prop("selected","selected");$(a).parent().children("span").html($(a+" option[value='0']").text())}function setOptions(c){if(c=="init"){$("#parameterSetting").html("");$("#customprams").html("");$.each(systemlistname,function(a,b){jQuery("<option value='"+a+"'>"+b+"</option>").appendTo("#parameterSetting")});$.each(systemlistname2,function(a,b){jQuery("<option value='"+a+"'>"+b+"</option>").appendTo("#customprams")});choosefirstOptionOfselectbox("#customprams");choosefirstOptionOfselectbox("#parameterSetting")}else{$.each(userdata_tel.userlistname,function(a,b){jQuery("<option value='"+a+"'>"+b+"</option>").appendTo("#customprams");jQuery("<option value='"+a+"'>"+b+"</option>").appendTo("#parameterSetting")})}}function controlloginIcon(){if(userdata_tel.status=="unlogin"){$("#userbtn").show();$("#userinfo").hide()}else{$("#userbtn").hide();$("#userinfo").html(current_telno);$("#userinfo").show()}}function addcondtion(){$("#condtionpanel").panel("close");var a=$("#condtionpanel").find("[name$='grid-checkbox']");for(var i=0;i<a.length;i++){if(a[i].checked==true){var b=$(a[i]).parent().parent().parent();b.addClass("invisibleofdiv");getConditonOpposit(b).removeClass("invisibleofdiv")}}}function getConditonOpposit(a){var b=$(a).attr("name");var c=$("[name$="+"'"+b+"'"+"]");for(var i=0;i<c.length;i++){if($(a).attr("id")==$(c[i]).attr("id")){if(i==0){return $(c[1])}else{return $(c[0])}}}}var gridc;function setObjectbeforedelete(a){gridc=$(a).parent().parent()}function deletecondtion(){gridc.addClass("invisibleofdiv");getConditonOpposit(gridc).removeClass("invisibleofdiv");gridc=null}$(function(){tableSort($('#table-custom-2'))});function tableSort(g){g.find('thead .sortable').click(function(){var a=$(this).attr('dataType');var b=$(this).closest('table');var c=b.find('thead th').index(this)+1;var d=[];var e=b.find('tbody tr');$.each(e,function(i){d[i]=e[i]});if($(this).hasClass('current')&&!dataResearchedFlg){d.reverse()}else{d.sort(h.sortStr(c,a));b.find('thead th').removeClass('current');$(this).addClass('current');dataResearchedFlg=false}var f=document.createDocumentFragment();$.each(d,function(i){f.appendChild(d[i])});b.find('tbody').append(f)});var h=(function(){function sortStr(e,f){return function(a,b){var c=$(a).find('td:nth-child('+e+')').attr('_order')||$(a).find('td:nth-child('+e+')').text();var d=$(b).find('td:nth-child('+e+')').attr('_order')||$(b).find('td:nth-child('+e+')').text();if(f!='text'){c=parseNonText(c,f);d=parseNonText(d,f);return c>d?-1:d>c?1:0}else{return c.localeCompare(d)}}}function parseNonText(a,b){switch(b){case'int':return parseInt(a)||0;case'float':return parseFloat(a)||0;default:return filterStr(a)}};function filterStr(a){if(!a){return 0}return parseFloat(a.replace(/^[\$a-zA-z\u4e00-\u9fa5 ]*(.*?)[a-zA-z\u4e00-\u9fa5 ]*$/,'$1'))}return{'sortStr':sortStr}})()}var contionnames=["dayparam","weekparam","kxdparam","kxwparam","ztparam","currentkparam","duringkparam","bankuaiparam"];function loadconditioncontroll(){$.each(contionnames,function(i,v){if(i==0){return true}var a=$("[name$="+"'"+v+"'"+"]");$(a.get(1)).addClass("invisibleofdiv");$(a.get(0)).removeClass("invisibleofdiv")})}function validatconditonForm(){var c=$('#conditonForm').validate({rules:{dayk_condition_text:{"intAndLengthRight":[4],"rangeCheck":{p1:[0,"第一个参数",3,30],p2:[1,"第二个参数",2,20],p3:[2,"第三个参数",0,99],p4:[3,"第四个参数",-1,1]}},weekk_condition_text:{"intAndLengthRight":[4],"rangeCheck":{p1:[0,"第一个参数",3,20],p2:[1,"第二个参数",2,20],p3:[2,"第三个参数",0,99],p4:[3,"第四个参数",-1,1]}},onlykd_condition_text:{"intAndLengthRight":[6],"rangeCheck":{p1:[0,"第一个参数",0,10],p2:[1,"第二个参数",0,20],p3:[2,"第三个参数",-1,1],p4:[3,"第四个参数",3,30],p5:[4,"第五个参数",3,30],p6:[5,"第六个参数",3,30]},"relativecheck":{r1:["1-0>0","第二个参数必须大于等于第一个参数"]}},onlykw_condition_text:{"intAndLengthRight":[6],"rangeCheck":{p1:[0,"第一个参数",0,10],p2:[1,"第二个参数",0,20],p3:[2,"第三个参数",-1,1],p4:[3,"第四个参数",3,30],p5:[4,"第五个参数",3,30],p6:[5,"第六个参数",3,30]},"relativecheck":{r1:["1-0>0","第一个参数必须大于等于第二个参数"]}},zt_condition_text:{"intAndLengthRight":[2],"rangeCheck":{p1:[0,"第一个参数",1,100],p2:[1,"第二个参数",0,20]},"relativecheck":{r1:["0-1>0","第一个参数必须大于等于第二个参数"]}},duringk_condition_text:{"intAndLengthRight":[3],"rangeCheck":{p1:[0,"第一个参数",0,20],p2:[1,"第二个参数",2,50],p3:[2,"第三个参数",1,500]}},currentk_condition_text:{"intAndLengthRight":[5],"rangeCheck":{p1:[0,"第一个参数",-1,1],p1:[1,"第二个参数",-1,1],p2:[2,"第三个参数",3,30],p3:[3,"第四个参数",-100,100],p4:[4,"第五个参数",-100,100]},"relativecheck":{r1:["4-3>0","第五个参数必须大于第四个参数"]}},bankuai_condition_text:{"intAndLengthInrange":[10000]}},errorPlacement:function(a,b){a.appendTo(b.parent().parent())}});return c}$(document).ready(function(){$("#login_okbtn").on("click",function(a){login(donothing)});var p=$("[id$='param_con']");for(var i=0;i<p.size();i++){var q=$(p[i]);var r=q.attr("name");var s=$("[name="+"'"+r+"'"+"]");if(q.hasClass("invisibleofdiv")){$(s.get(0)).removeClass("invisibleofdiv")}else{$(s.get(0)).addClass("invisibleofdiv")}}jQuery.validator.addMethod("intAndLengthRight",function(f,g,h){return this.optional(g)||function(a,b,c){var d=a.split(",");var e=/[^0-9|\,|\-| ]/;if(e.test(a)){return false}if(d.length!=c[0]){return false}else{for(var i=0;i<d.length;i++){var t=parseInt(d[i],10);if(isNaN(t)){return false}}return true}}(f,g,h)},"格式有误，请修正输入！");jQuery.validator.addMethod("intAndLengthInrange",function(f,g,h){return this.optional(g)||function(a,b,c){var d=a.split(",");var e=/[^0-9|\,|\-| ]/;if(e.test(a)){return false}if(d.length>c[0]){return false}else{for(var i=0;i<d.length;i++){var t=parseInt(d[i],10);if(isNaN(t)){return false}}return true}}(f,g,h)},"格式有误，请修正输入！");jQuery.validator.addMethod("samename",function(g,h,i){return this.optional(h)||function(c,d,e){var f=true;$("#parameterSetting option").each(function(a,b){if($.trim($(b).html())==$.trim(d.value)){f=false;return false}});return f}(g,h,i)},"参数名已经存在，请重命名");jQuery.validator.addMethod("paramcounter",function(h,i,j){return this.optional(i)||function(c,d,e){var f=true;var g=0;$("#parameterSetting option").each(function(a,b){g++;if(g>28){f=false;return false}});return f}(h,i,j)},"参数名个数已超，请删除一些");jQuery.validator.addMethod("validcellno",function(e,f,g){return this.optional(f)||function(a,b,c){var d=/^1[0-9][0-9]\d{8,8}$/;if(!d.test(a)){return false}return true}(e,f,g)},"非有效手机号码");jQuery.validator.addMethod("rangeCheck",function(j,k,l){return this.optional(k)||function(e,f,g){var h=e.split(",");var i=false;$.each(g,function(a,b){var c=(b+"").split(",");var d=parseInt(h[c[0]]);if(d<c[2]||d>c[3]){i=true;return false}});return!i}(j,k,l)},function(e){var f=$.makeArray(arguments).slice(1);var g;var h=f[0].value.split(",");$.each(e,function(a,b){var c=(b+"").split(",");var d=parseInt(h[c[0]]);if(d<c[2]||d>c[3]){g=c;return false}});return jQuery.validator.format("{1}:请修正设定在{2}到{3}整数范围内",g)});jQuery.validator.addMethod("relativecheck",function(m,n,o){return this.optional(n)||function(g,h,j){var k=g.split(",");var l=false;$.each(j,function(a,b){var c=(b+"").split(",");var d=c[0].split(">");var e=d[0].split("-");var f=parseInt(k[e[0]]);for(var i=1;i<e.length;i++){f=f-parseInt(k[e[i]])}if(f<0){l=true;return false}});return!l}(m,n,o)},function(g){var h=$.makeArray(arguments).slice(1);var j;var k=h[0].value.split(",");$.each(g,function(a,b){var c=(b+"").split(",");var d=c[0].split(">");var e=d[0].split("-");var f=parseInt(k[e[0]]);for(var i=1;i<e.length;i++){f=f-parseInt(k[e[i]])}if(f<0){j=c;return false}});return jQuery.validator.format("{1}",j)});validatconditonForm();var u=$('#saveeditor_form').validate({rules:{parametername:{required:true,maxlength:15,"samename":true,"paramcounter":true}},messages:{parametername:{required:"请输入参数名",maxlength:"参数名最长不能超过{0}个字"}},errorPlacement:function(a,b){a.appendTo(b.parent().parent())}});var u=$('#loginform').validate({rules:{cellno:{required:true,"validcellno":true}},messages:{cellno:{required:"请输入手机号码"}},errorPlacement:function(a,b){a.appendTo(b.parent().parent())}});var a=function(){if(window.localStorage){if(localStorage.hasOwnProperty("users")){var e=JSON.parse(localStorage.getItem("users"));$.each(e,function(a,b){users.push(b)});var f=0;$.each(users,function(c,d){f++;$.each(d,function(a,b){if(b.status=="login"){current_telno=a;userdata_tel=b}})});if(f>10){users.remove(0,f-10-1);localStorage.users=JSON.stringify(users)}}}if($.isEmptyObject(userdata_tel)){var t=inituserdata_tel();userdata_tel=t["00000000"];current_telno="00000000";if($.isEmptyObject(users)){users.push(t)}}}();setOptions();controlloginIcon();loadconditioncontroll();$('html').bind('keypress',function(e){if(e.keyCode==13){return false}});$(document).bind('contextmenu',function(e){return false})});