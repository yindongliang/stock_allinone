function inituserdata_tel(){var e={};var t={};t["data"]={};t["counter"]=2;t["status"]="unlogin";t["userlistname"]={};e["00000000"]=t;return e}function getTelInfo(e){}function getSearchResult(){if(!islogin()){$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(e){login(getSearchResult)});$("#popupLogin").popup("open");return}var e=validatconditonForm();if(e.numberOfInvalids()>0){return}var t={};var n=$("[id$='param_con']");for(var r=0;r<n.size();r++){var i=$(n[r]);if(i.hasClass("invisibleofdiv")){continue}else{var s=i.find($("[name$='_condition_text']"));var o={};if(s.val()==""){continue}o[s.attr("id")]=s.val();t=$.extend(true,t,o)}}if($.isEmptyObject(t)){return}t["tel"]=current_telno;var u=window.location.href;var a;if(u.lastIndexOf("/","http")!=u.length-1){a="deal/"+JSON.stringify(t)}else{a=JSON.stringify(t)}htmlobj=$.ajax({url:a,async:false});var f=htmlobj.responseText;$("#table-custom-2").table("refresh");$("#dataResult").html(htmlobj.responseText);$("#table-custom-2").table("refresh");$("#msgzone").html($("#resultmsg").html());$("#resultmsg").remove();dataResearchedFlg=true}function islogin(){if(userdata_tel.status=="unlogin"){return false}return true}function login(e){if(!$("#loginform").valid()){return false}var t=false;$.each(users,function(e,n){$.each(n,function(e,n){if(e==$(tel).val()){n.status="login";userdata_tel=n;current_telno=$(tel).val();t=true;return}});if(t)return});if(!t){var n={};var r=inituserdata_tel();current_telno=$(tel).val();r["00000000"].status="login";n[$(tel).val()]=r["00000000"];userdata_tel=n[$(tel).val()];users.push(n)}setOptions();controlloginIcon();localStorage.users=JSON.stringify(users);$("#popupLogin").unbind("popupafterclose");$("#popupLogin").on("popupafterclose",function(t,n){e();$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(e){login(donothing)})});$("#popupLogin").popup("close");return true}function donothing(){}function logout(){$.each(users,function(e,t){$.each(t,function(e,t){t.status="unlogin"})});current_telno="00000000";userdata_tel=inituserdata_tel()["00000000"];setOptions("init");controlloginIcon();localStorage.users=JSON.stringify(users)}function insertSlectBoxOption(e){userdata_temp=userdata_tel.data;if(!$("#saveeditor_form").valid()){return false}userdata_tel.counter++;var t={};$("[name$='_condition_text']").each(function(e,n){if(!$("#"+n.id).parent().parent().parent().hasClass("invisibleofdiv")){var r={};r[n.id]=n.value;t=$.extend(true,t,r)}});userdata_temp[userdata_tel.counter]=t;jQuery("<option value='"+userdata_tel.counter+"'>"+$("#parametername").val()+"</option>").appendTo("#"+e);jQuery("<option value='"+userdata_tel.counter+"'>"+$("#parametername").val()+"</option>").appendTo("#customprams");userdata_tel.data=userdata_temp;userdata_tel.userlistname[userdata_tel.counter]=$("#parametername").val();if(window.localStorage){localStorage.users=JSON.stringify(users)}$("#popupSaveoredit").popup("close")}function openpopupforDeletePram(){var e=$("#customprams").val();if(e==0){return}else{$("#popupforDeletePram").popup("open")}}function openeditsavePopup(){if(!islogin()){$("#login_okbtn").unbind("click");$("#login_okbtn").on("click",function(e){login(openeditsavePopup)});$("#popupLogin").popup("open")}else{$("#popupSaveoredit").popup("open")}}function deletecustomParams(){var e=$("#customprams").val();choosefirstOptionOfselectbox("#customprams");choosefirstOptionOfselectbox("#parameterSetting");$("#customprams option[value="+e+"]").remove();$("#parameterSetting option[value="+e+"]").remove();$.each(userdata_tel.data[e],function(e,t){$("#"+e+"_editor").val("")});delete userdata_tel.data[e];delete userdata_tel.userlistname[e];if(window.localStorage){localStorage.users=JSON.stringify(users)}}function getValuessub(e,t){var n={};$.each(t,function(e,t){n[e]=t});$.each(e,function(e,t){delete n[e]});return n}function setValues(e){if(e=="0"){return}var t;if(e!="1"&&e!="2"){t=userdata_tel.data}else{t=systemdata}if(e!="1"&&e!="2"){var n=getValuessub(t[e],systemdata["1"]);$.each(n,function(e,t){var n=$("#"+e);var r=n.parent().parent().parent();var i=r.attr("name");var s=$("[name="+"'"+i+"'"+"]");r.addClass("invisibleofdiv");$(s.get(0)).removeClass("invisibleofdiv")});$.each(t[e],function(e,t){var n=$("#"+e);n.val(t);var r=n.parent().parent().parent();var i=r.attr("name");var s=$("[name="+"'"+i+"'"+"]");$(s.get(0)).addClass("invisibleofdiv");r.removeClass("invisibleofdiv")})}else{$.each(t[e],function(e,t){var n=$("#"+e);n.val(t)})}return false}function setValuesForeditor(e){if(e=="0"){return}var t;t=userdata_tel.data;$.each(t[e],function(e,t){$("#"+e+"_editor").val(t)});return false}function openpopupforSavePram(){var e=$("#customprams").val();if(e==0){return}else{$("#popupforSavePram").popup("open")}}function saveEditor(){var e={};$("[name$='_editor_text']").each(function(t,n){var r={};r[n.id.split("_")[0]]=n.value;e=$.extend(true,e,r)});userdata_tel.data[$("#customprams").val()]=e;if(window.localStorage){localStorage.userdata_tel=JSON.stringify(userdata_tel)}choosefirstOptionOfselectbox("#parameterSetting")}function choosefirstOptionOfselectbox(e){$(e+" option[value='0']").prop("selected","selected");$(e).parent().children("span").html($(e+" option[value='0']").text())}function setOptions(e){if(e=="init"){$("#parameterSetting").html("");$("#customprams").html("");$.each(systemlistname,function(e,t){jQuery("<option value='"+e+"'>"+t+"</option>").appendTo("#parameterSetting")});$.each(systemlistname2,function(e,t){jQuery("<option value='"+e+"'>"+t+"</option>").appendTo("#customprams")});choosefirstOptionOfselectbox("#customprams");choosefirstOptionOfselectbox("#parameterSetting")}else{$.each(userdata_tel.userlistname,function(e,t){jQuery("<option value='"+e+"'>"+t+"</option>").appendTo("#customprams");jQuery("<option value='"+e+"'>"+t+"</option>").appendTo("#parameterSetting")})}}function controlloginIcon(){if(userdata_tel.status=="unlogin"){$("#userbtn").show();$("#userinfo").hide()}else{$("#userbtn").hide();$("#userinfo").html(current_telno);$("#userinfo").show()}}function addcondtion(){$("#condtionpanel").panel("close");var e=$("#condtionpanel").find("[name$='grid-checkbox']");for(var t=0;t<e.length;t++){if(e[t].checked==true){var n=$(e[t]).parent().parent().parent();n.addClass("invisibleofdiv");getConditonOpposit(n).removeClass("invisibleofdiv")}}}function getConditonOpposit(e){var t=$(e).attr("name");var n=$("[name$="+"'"+t+"'"+"]");for(var r=0;r<n.length;r++){if($(e).attr("id")==$(n[r]).attr("id")){if(r==0){return $(n[1])}else{return $(n[0])}}}}function setObjectbeforedelete(e){gridc=$(e).parent().parent()}function deletecondtion(){gridc.addClass("invisibleofdiv");getConditonOpposit(gridc).removeClass("invisibleofdiv");gridc=null}function tableSort(e){e.find("thead .sortable").click(function(){var e=$(this).attr("dataType");var n=$(this).closest("table");var r=n.find("thead th").index(this)+1;var i=[];var s=n.find("tbody tr");$.each(s,function(e){i[e]=s[e]});if($(this).hasClass("current")&&!dataResearchedFlg){i.reverse()}else{i.sort(t.sortStr(r,e));n.find("thead th").removeClass("current");$(this).addClass("current");dataResearchedFlg=false}var o=document.createDocumentFragment();$.each(i,function(e){o.appendChild(i[e])});n.find("tbody").append(o)});var t=function(){function e(e,n){return function(r,i){var s=$(r).find("td:nth-child("+e+")").attr("_order")||$(r).find("td:nth-child("+e+")").text();var o=$(i).find("td:nth-child("+e+")").attr("_order")||$(i).find("td:nth-child("+e+")").text();if(n!="text"){s=t(s,n);o=t(o,n);return s>o?-1:o>s?1:0}else{return s.localeCompare(o)}}}function t(e,t){switch(t){case"int":return parseInt(e)||0;case"float":return parseFloat(e)||0;default:return n(e)}}function n(e){if(!e){return 0}return parseFloat(e.replace(/^[\$a-zA-z\u4e00-\u9fa5 ]*(.*?)[a-zA-z\u4e00-\u9fa5 ]*$/,"$1"))}return{sortStr:e}}()}function loadconditioncontroll(){$.each(contionnames,function(e,t){if(e==0){return true}var n=$("[name$="+"'"+t+"'"+"]");$(n.get(1)).addClass("invisibleofdiv");$(n.get(0)).removeClass("invisibleofdiv")})}function validatconditonForm(){var e=$("#conditonForm").validate({rules:{dayk_condition_text:{intAndLengthRight:[4],rangeCheck:{p1:[0,"第一个参数",3,30],p2:[1,"第二个参数",2,20],p3:[2,"第三个参数",0,99],p4:[3,"第四个参数",-1,1]}},weekk_condition_text:{intAndLengthRight:[4],rangeCheck:{p1:[0,"第一个参数",3,20],p2:[1,"第二个参数",2,20],p3:[2,"第三个参数",0,99],p4:[3,"第四个参数",-1,1]}},onlykd_condition_text:{intAndLengthRight:[6],rangeCheck:{p1:[0,"第一个参数",0,10],p2:[1,"第二个参数",0,20],p3:[2,"第三个参数",-1,1],p4:[3,"第四个参数",3,30],p5:[4,"第五个参数",3,30],p6:[5,"第六个参数",3,30]},relativecheck:{r1:["1-0>0","第二个参数必须大于等于第一个参数"]}},onlykw_condition_text:{intAndLengthRight:[6],rangeCheck:{p1:[0,"第一个参数",0,10],p2:[1,"第二个参数",0,20],p3:[2,"第三个参数",-1,1],p4:[3,"第四个参数",3,30],p5:[4,"第五个参数",3,30],p6:[5,"第六个参数",3,30]},relativecheck:{r1:["1-0>0","第一个参数必须大于等于第二个参数"]}},zt_condition_text:{intAndLengthRight:[2],rangeCheck:{p1:[0,"第一个参数",1,100],p2:[1,"第二个参数",0,20]},relativecheck:{r1:["0-1>0","第一个参数必须大于等于第二个参数"]}},duringk_condition_text:{intAndLengthRight:[3],rangeCheck:{p1:[0,"第一个参数",0,20],p2:[1,"第二个参数",2,50],p3:[2,"第三个参数",1,500]}},currentk_condition_text:{intAndLengthRight:[5],rangeCheck:{p1:[0,"第一个参数",-1,1],p1:[1,"第二个参数",-1,1],p2:[2,"第三个参数",3,30],p3:[3,"第四个参数",-100,100],p4:[4,"第五个参数",-100,100]},relativecheck:{r1:["4-3>0","第五个参数必须大于第四个参数"]}},bankuai_condition_text:{intAndLengthInrange:[1e4]}},errorPlacement:function(e,t){e.appendTo(t.parent().parent())}});return e}var userdata_tel={};var users=[];var current_telno;var dataResearchedFlg=false;var systemlistname={0:"参数设定",1:"强市参数(系统)",2:"弱市参数(系统)"};var systemlistname2={0:"自定义参数列表"};var systemdata={1:{dayk:"5,8,80,1",weekk:"5,8,80,1",onlykd:"0,3,1,5,10,20",onlykw:"0,3,1,5,10,10",zt:"100,2",currentk:"1,1,5,-5,5",duringk:"0,30,25",bankuai:"00,30,60"},2:{dayk:"5,8,50,-1",weekk:"5,8,50,1",onlykd:"0,3,1,5,10,20",onlykw:"0,3,1,5,10,10",zt:"100,5",currentk:"1,-1,5,-5,5",duringk:"0,30,15",bankuai:"00,30,60"}};var userdata_temp={};$(document).on("click",".show-page-loading-msg",function(){var e=$(this),t=e.jqmData("theme")||$.mobile.loader.prototype.options.theme,n=e.jqmData("msgtext")||$.mobile.loader.prototype.options.text,r=e.jqmData("textvisible")||$.mobile.loader.prototype.options.textVisible,i=!!e.jqmData("textonly");html=e.jqmData("html")||"";$.mobile.loading("show",{text:n,textVisible:r,theme:t,textonly:i,html:html})}).on("click",".hide-page-loading-msg",function(){$.mobile.loading("hide")});Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);this.length=e<0?this.length+e:e;return this.push.apply(this,n)};var gridc;$(function(){tableSort($("#table-custom-2"))});var contionnames=["dayparam","weekparam","kxdparam","kxwparam","ztparam","currentkparam","duringkparam","bankuaiparam"];$(document).ready(function(){$("#login_okbtn").on("click",function(e){login(donothing)});var e=$("[id$='param_con']");for(var t=0;t<e.size();t++){var n=$(e[t]);var r=n.attr("name");var i=$("[name="+"'"+r+"'"+"]");if(n.hasClass("invisibleofdiv")){$(i.get(0)).removeClass("invisibleofdiv")}else{$(i.get(0)).addClass("invisibleofdiv")}}jQuery.validator.addMethod("intAndLengthRight",function(e,t,n){return this.optional(t)||function(e,t,n){var r=e.split(",");var i=/[^0-9|\,|\-| ]/;if(i.test(e)){return false}if(r.length!=n[0]){return false}else{for(var s=0;s<r.length;s++){var o=parseInt(r[s],10);if(isNaN(o)){return false}}return true}}(e,t,n)},"格式有误，请修正输入！");jQuery.validator.addMethod("intAndLengthInrange",function(e,t,n){return this.optional(t)||function(e,t,n){var r=e.split(",");var i=/[^0-9|\,|\-| ]/;if(i.test(e)){return false}if(r.length>n[0]){return false}else{for(var s=0;s<r.length;s++){var o=parseInt(r[s],10);if(isNaN(o)){return false}}return true}}(e,t,n)},"格式有误，请修正输入！");jQuery.validator.addMethod("samename",function(e,t,n){return this.optional(t)||function(e,t,n){var r=true;$("#parameterSetting option").each(function(e,n){if($.trim($(n).html())==$.trim(t.value)){r=false;return false}});return r}(e,t,n)},"参数名已经存在，请重命名");jQuery.validator.addMethod("paramcounter",function(e,t,n){return this.optional(t)||function(e,t,n){var r=true;var i=0;$("#parameterSetting option").each(function(e,t){i++;if(i>28){r=false;return false}});return r}(e,t,n)},"参数名个数已超，请删除一些");jQuery.validator.addMethod("validcellno",function(e,t,n){return this.optional(t)||function(e,t,n){var r=/^1[0-9][0-9]\d{8,8}$/;if(!r.test(e)){return false}return true}(e,t,n)},"非有效手机号码");jQuery.validator.addMethod("rangeCheck",function(e,t,n){return this.optional(t)||function(e,t,n){var r=e.split(",");var i=false;$.each(n,function(e,t){var n=(t+"").split(",");var s=parseInt(r[n[0]]);if(s<n[2]||s>n[3]){i=true;return false}});return!i}(e,t,n)},function(e){var t=$.makeArray(arguments).slice(1);var n;var r=t[0].value.split(",");$.each(e,function(e,t){var i=(t+"").split(",");var s=parseInt(r[i[0]]);if(s<i[2]||s>i[3]){n=i;return false}});return jQuery.validator.format("{1}:请修正设定在{2}到{3}整数范围内",n)});jQuery.validator.addMethod("relativecheck",function(e,t,n){return this.optional(t)||function(e,t,n){var r=e.split(",");var i=false;$.each(n,function(e,t){var n=(t+"").split(",");var s=n[0].split(">");var o=s[0].split("-");var u=parseInt(r[o[0]]);for(var a=1;a<o.length;a++){u=u-parseInt(r[o[a]])}if(u<0){i=true;return false}});return!i}(e,t,n)},function(e){var t=$.makeArray(arguments).slice(1);var n;var r=t[0].value.split(",");$.each(e,function(e,t){var i=(t+"").split(",");var s=i[0].split(">");var o=s[0].split("-");var u=parseInt(r[o[0]]);for(var a=1;a<o.length;a++){u=u-parseInt(r[o[a]])}if(u<0){n=i;return false}});return jQuery.validator.format("{1}",n)});validatconditonForm();var s=$("#saveeditor_form").validate({rules:{parametername:{required:true,maxlength:15,samename:true,paramcounter:true}},messages:{parametername:{required:"请输入参数名",maxlength:"参数名最长不能超过{0}个字"}},errorPlacement:function(e,t){e.appendTo(t.parent().parent())}});var s=$("#loginform").validate({rules:{cellno:{required:true,validcellno:true}},messages:{cellno:{required:"请输入手机号码"}},errorPlacement:function(e,t){e.appendTo(t.parent().parent())}});var o=function(){if(window.localStorage){if(localStorage.hasOwnProperty("users")){var e=JSON.parse(localStorage.getItem("users"));$.each(e,function(e,t){users.push(t)});var t=0;$.each(users,function(e,n){t++;$.each(n,function(e,t){if(t.status=="login"){current_telno=e;userdata_tel=t}});});if(t>10){users.remove(0,t-10-1);localStorage.users=JSON.stringify(users)}}}if($.isEmptyObject(userdata_tel)){var n=inituserdata_tel();userdata_tel=n["00000000"];current_telno="00000000";if($.isEmptyObject(users)){users.push(n)}}}();setOptions();controlloginIcon();loadconditioncontroll();$("html").bind("keypress",function(e){if(e.keyCode==13){return false}})})